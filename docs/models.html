<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>

    <title>Patio - Associations</title>
    <meta name="generator" content="JsDoc Toolkit"/>
    <link type="text/css" href="./api/css/default.css" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"
            charset="utf-8"></script>
    <script type="text/javascript" src="./api/js/doc.js"></script>
    <script type="text/javaScript" src="./api/js/chili/jquery.chili-2.2.js"></script>
    <script type="text/javaScript" src="./api/js/chili/recipes.js"></script>
</head>
<!--[if gte IE 9]>
<style type="text/css">
    * {
        filter: none !important;
    }
</style>
<![endif]-->
<style type="text/css">
    .featureList li {
        margin: 10px;
    }
</style>
<body>

<a href="http://github.com/doug-martin/patio-query" target="_blank">
    <img style="position: absolute; top: 0; right: 0; border: 0;"
         src="https://a248.e.akamai.net/assets.github.com/img/71eeaab9d563c2b3c590319b398dd35683265e85/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67"
         alt="Fork me on GitHub">
</a>


<div class="menuContainer">
    <div class="menuContainerContent">
        <ul>
            <li><span
                    class='nodeContainer'><a href="./index.html" class=""><span>Patio</span></a></span></li>
            <li><span class='nodeContainer'><a href="./api/index.html" target="_blank"
                                               class=""><span>API</span></a></span></li>
            <li>
                <span class='nodeContainer'>
                    <a href="./connecting.html" class="">
                        <span>Connecting to a database</span>
                    </a>
                </span>
            </li>
            <li>
                <span class='nodeContainer'>
                    <a href="./DDL.html" class="">
                        <span>Schema CRUD</span>
                    </a>
                </span>
            </li>
            <li>
                <span class='nodeContainer'>
                    <a href="./associations.html" class="">
                        <span>Model Associations</span>
                    </a>
                </span>
            </li>
        </ul>
    </div>
</div>
<div class="contentContainer">
    <div id="content">
        <div class="section">
            <h1 class="classTitle"><a href="./api/symbols/patio.Model.html" target="_blank">Models</a></h1>

            <div class="methodDetail">
                Models are an optional feature in patio that can be extended to encapsulate, query, and associate 
                tables.
                <p>
                    When defining a model it is assumed that the database table already exists. So before defining a 
                    model you must create the table/s that the model requires to function including associations. To 
                    create a model you must <a href="./connecting.html">connect</a> to a database.                    
                </p>
                <p>
                    An example model definition flow.
                    <pre class="code">
patio.camelize = true;

comb.logging.Logger.getRootLogger().level = comb.logging.Level.ERROR;

//disconnect and error callback helpers
var disconnect = comb.hitch(patio, "disconnect");
var disconnectError = function(err) {
    patio.logError(err);
    patio.disconnect();
};

var connectAndCreateSchema = function(){
    //This assumes new tables each time you could just connect to the database
    return patio.connectAndExecute("mysql://test:testpass@localhost:3306/sandbox",
        function(db, patio){
            //drop and recreate the user
            db.forceCreateTable("user", function(){
                this.primaryKey("id");
                this.firstName(String)
                this.lastName(String);
                this.password(String);
                this.dateOfBirth(Date);
                this.created(sql.TimeStamp);
                this.updated(sql.DateTime);
            });
        });
};

var defineModel = function(){
    return patio.addModel("user");
};

//connect and create schema
connectAndCreateSchema()
    .chain(defineModel, disconnectError)
    .then(function(){
         var User = patio.getModel("user");
         var myUser = new User({
             firstName : "Bob",
             lastName : "Yukon",
             password : "password",
             dateOfBirth : new Date(1980, 8, 29)
         });
        //save the user
        myUser.save().then(function(user){
            console.log(format("%s %s's id is %d", user.firstName, user.lastName, user.id));
            disconnect();
        }, disconnectError);
    }, disconnectError);
                    </pre>
                The above example:
                <ul>
                    <li>Connects to a database and creates the "user" table.</li>
                    <li>Defines a User model, remember addModel returns a promise.</li>
                    <li>Create a new User
                        <ul>
                            <li>Save the user</li>
                            <li>Print out some user details, at this point the user is saved in the database</li>
                            <li>disconnect from the database</li>
                        </ul>
                    </li>
                </ul>
                The final output should be "BobYukon's id is 1".
                </p>
            </div>
        </div>
    </div>
</div>
</body>
</html>